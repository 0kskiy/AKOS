# ОТЧЕТ

ФИО: Бочкарев Максим Андреевич

Группа: Бпи-245-2

Номер варианта: 32

---


## 0. ИНСТРУКЦИЯ ПО ЗАПУСКУ

### 0.1. Сборка проекта

```bash
# Собрать обе программы
make all

# Или собрать отдельно
g++ -std=c++17 -pthread -o
treasure_semaphore treasure_semaphore.cpp
g++ -std=c++17 -pthread -o treasure_condvar treasure_condvar.cpp
```

### 0.2. Варианты запуска

**Базовый запуск:**

```bash
# Программа запросит параметры в консоли
./treasure_semaphore
```

**Запуск с параметрами:**

```bash
# Через командную строку
./treasure_semaphore <участки> <группы>

# Пример
./treasure_semaphore 20 5
```

**Расширенный запуск:**

```bash
# С выводом в файл
./treasure_semaphore 20 5 -o result.txt

# Из конфигурационного файла
./treasure_semaphore -c config.txt

# Комбинированный вариант
./treasure_semaphore -c config.txt -o output.txt
```

**Запуск второй программы:**

```bash
# Версия на условных переменных
./treasure_condvar 20 5 -o result_condvar.txt
```

### 0.3. Автоматическое тестирование

```bash
# Запуск всех тестов из Makefile
make test

# Создание тестовых файлов
./setup.sh
```


## 1. УСЛОВИЕ ЗАДАЧИ

Джон Сильвер разделил остров на **N** участков и сформировал **M** групп пиратов для поиска клада (**N > M**). Каждая группа получает задание из общего *портфеля задач* (участок для обследования). Клад спрятан на одном случайном участке. Когда клад найден, все группы возвращаются к Сильверу. Сильвер (управляющий поток) координирует поиск и объявляет результаты.

---

## 2. СЦЕНАРИЙ РЕШЕНИЯ

### 2.1. Отображение сущностей в процессы

* **Джон Сильвер** → управляющий поток `silver_thread`
* **Группа пиратов** → рабочий поток `pirate_group_thread`
* **Участок острова** → структура данных `Sector`
* **Поручение на поиск** → элемент портфеля задач (общий счётчик `current_sector`)

### 2.2. Ролевое поведение субъектов

**Джон Сильвер (управляющий):**

1. Прибывает на остров и делит его на участки
2. Формирует группы пиратов
3. Ожидает возвращения всех групп
4. Объявляет итог поисков (клад найден / не найден)
5. Отправляет всех на корабль

**Группа пиратов (рабочий поток):**

1. Сообщает о готовности к поиску
2. Берёт свободный участок из общего портфеля задач
3. Обследует участок (ищет клад)
4. При нахождении клада уведомляет остальные потоки
5. Возвращается к Сильверу с отчётом
6. Если клад уже найден — завершает работу досрочно

### 2.3. Взаимодействие процессов

* Рабочие потоки **конкурируют** за получение участков
* Управляющий поток **ожидает** завершения всех рабочих
* При нахождении клада выполняется **уведомление** всех потоков
* Синхронизация обеспечивается стандартными примитивами

---

## 3. МОДЕЛЬ ПАРАЛЛЕЛЬНЫХ ВЫЧИСЛЕНИЙ

Использована модель **«Управляющий и рабочие потоки»** в сочетании с моделью **«Портфель задач»**:

* **Управляющий поток (1)** — Джон Сильвер
* **Рабочие потоки (M)** — группы пиратов
* **Портфель задач** — общий счётчик участков
* **Общая память** — вектор участков, флаги состояния, статистика

---

## 4. ВХОДНЫЕ ДАННЫЕ

### 4.1. Параметры программы

* `N` — количество участков острова (`N > 0`)
* `M` — количество групп пиратов (`0 < M < N`)

### 4.2. Диапазоны значений

* Количество участков `N`: от 10 до 1000
* Количество групп `M`: от 2 до 50
* Время поиска участка: от 1 до 3 секунд

### 4.3. Генераторы случайных чисел

**Размещение клада:**

* `std::uniform_int_distribution<>(0, N - 1)`
* Клад может находиться на любом участке

**Время поиска:**

* `std::uniform_int_distribution<>(1, 3)`
* Имитирует различную сложность обследования

---

## 5. ТЕХНИЧЕСКАЯ РЕАЛИЗАЦИЯ

### 5.1. Программа на 4–5 баллов

* **Язык:** C++ (`<thread>`)
* **Синхронизация:** `std::mutex` и самописный `Semaphore`
* **Ввод:** с консоли
* **Вывод:** подробный, в терминах предметной области

### 5.2. Модификация на 6–7 баллов

* Добавлена генерация случайных данных
* Ввод параметров через командную строку

```bash
./treasure_semaphore <участки> <группы>
```

### 5.3. Модификация на 8 баллов

* Вывод в консоль и файл (`-o`)
* Ввод из конфигурационного файла (`-c`)

```bash
./treasure_semaphore 20 5 -o output.txt
./treasure_semaphore -c config.txt -o output.txt
```

**Конфигурационные файлы:**

```text
config1.txt: 15 4
config2.txt: 30 5
config3.txt: 50 8
```

---

### 5.4. Модификация на 9–10 баллов

Вторая программа: `treasure_condvar.cpp`

* Использованы `std::condition_variable`, `std::atomic`, `std::mutex`
* Поведение обеих программ идентично при одинаковых входных данных

---

## 6. КОРРЕКТНОЕ ЗАВЕРШЕНИЕ ПРОГРАММЫ

### 6.1. Завершение по условию задачи

* При нахождении клада — корректное завершение всех потоков
* При обследовании всех участков — вывод итоговой статистики
* Если клад не найден — соответствующее сообщение

### 6.2. Завершение по сигналу (Ctrl+C)

```cpp
void signal_handler(int signum) {
    stop_flag = true;
    portfolio_cond.notify_all();
    silver_cond.notify_all();
}

signal(SIGINT, signal_handler);
signal(SIGTERM, signal_handler);
```

---

## 7. РЕЗУЛЬТАТЫ РАБОТЫ ПРОГРАММЫ

### 7.1. Пример вывода

```text
=== ЗАДАЧА ОБ ОСТРОВЕ СОКРОВИЩ ===
=== Решение на семафорах (C++) ===

Параметры:
  Количество участков: 20
  Количество групп: 5


[СИЛЬВЕР] Джон Сильвер прибыл на остров!
[СИЛЬВЕР] Разделил остров на 20 участков
[СИЛЬВЕР] Сформировал 5 поисковых групп
[СИЛЬВЕР] Клад спрятан на участке 4

[ГРУППА 4] Группа пиратов готова к поиску!
[ГРУППА 4] Начинаем обследование участка 0
[ГРУППА 3] Группа пиратов готова к поиску!
[ГРУППА 3] Начинаем обследование участка 1
[ГРУППА 1] Группа пиратов готова к поиску!
[ГРУППА 1] Начинаем обследование участка 2
[ГРУППА 2] Группа пиратов готова к поиску!
[ГРУППА 2] Начинаем обследование участка 3
[ГРУППА 5] Группа пиратов готова к поиску!
[ГРУППА 5] Начинаем обследование участка 4
[ГРУППА 4] Участок 0 обследован. Клада нет.
[ГРУППА 4] Начинаем обследование участка 5
[ГРУППА 1] Участок 2 обследован. Клада нет.
[ГРУППА 1] Начинаем обследование участка 6
[ГРУППА 2] Участок 3 обследован. Клада нет.
[ГРУППА 2] Начинаем обследование участка 7

[ГРУППА 5] *** КЛАД НАЙДЕН НА УЧАСТКЕ 4! ***

[ГРУППА 5] Возвращаемся к Сильверу. Обследовано участков: 1
[СИЛЬВЕР] Отлично! Клад найден на участке 4!
[СИЛЬВЕР] Все группы, возвращайтесь на корабль!
[СИЛЬВЕР] Отлично! Клад найден на участке 4!
[СИЛЬВЕР] Все группы, возвращайтесь на корабль!
[ГРУППА 1] Участок 6 обследован. Клада нет.
[ГРУППА 1] Возвращаемся к Сильверу. Обследовано участков: 2
[СИЛЬВЕР] Отлично! Клад найден на участке 4!
[СИЛЬВЕР] Все группы, возвращайтесь на корабль!
[ГРУППА 3] Участок 1 обследован. Клада нет.
[ГРУППА 3] Возвращаемся к Сильверу. Обследовано участков: 1
[СИЛЬВЕР] Отлично! Клад найден на участке 4!
[СИЛЬВЕР] Все группы, возвращайтесь на корабль!
[ГРУППА 2] Участок 7 обследован. Клада нет.
[ГРУППА 2] Возвращаемся к Сильверу. Обследовано участков: 2
[СИЛЬВЕР] Отлично! Клад найден на участке 4!
[СИЛЬВЕР] Все группы, возвращайтесь на корабль!

[СИЛЬВЕР] Поиски завершены. Все группы вернулись.
[ГРУППА 4] Участок 5 обследован. Клада нет.
[ГРУППА 4] Возвращаемся к Сильверу. Обследовано участков: 2

=== ИТОГИ ПОИСКА ===
Результат: КЛАД НАЙДЕН на участке 4
Обследовано участков: 8 из 20

Статистика по группам:
  Группа 1: обследовала 2 участков
  Группа 2: обследовала 2 участков
  Группа 3: обследовала 1 участков
  Группа 4: обследовала 2 участков
  Группа 5: обследовала 1 участков

```

### 7.2. Информативность вывода

* Все ключевые события отображаются в терминах предметной области
* Ход выполнения нагляден и понятен
* Сообщения читаемы без знания внутренней реализации
